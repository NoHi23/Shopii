{"ast":null,"code":"var _jsxFileName = \"D:\\\\SU25\\\\SDN302 - HOANNN\\\\Shopii-Template\\\\front-end\\\\src\\\\pages\\\\Payment\\\\Payment.jsx\",\n  _s = $RefreshSig$(),\n  _s2 = $RefreshSig$();\nimport React, { useState, useEffect, useRef } from \"react\";\nimport { useLocation, useNavigate } from \"react-router-dom\";\nimport { useDispatch, useSelector } from \"react-redux\";\nimport { toast } from \"react-toastify\";\nimport { createPayment, resetPayment, checkPaymentStatus, cancelPaymentPolling } from \"../../features/payment/paymentSlice\";\nimport { motion } from \"framer-motion\";\nimport { Box, Container, Typography, Radio, RadioGroup, FormControlLabel, FormControl, Button, Paper, Divider, CircularProgress, Grid } from \"@mui/material\";\nimport PaymentIcon from \"@mui/icons-material/Payment\";\nimport LocalAtmIcon from \"@mui/icons-material/LocalAtm\";\nimport HomeIcon from \"@mui/icons-material/Home\";\nimport ArrowBackIcon from \"@mui/icons-material/ArrowBack\";\n\n// ✨ CUSTOM HOOK: Tách logic polling ra khỏi component để tái sử dụng và quản lý dễ dàng hơn\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nimport { Fragment as _Fragment } from \"react/jsx-dev-runtime\";\nconst usePaymentPolling = (orderId, shouldPoll, onPaymentSuccess, onPaymentFail, onTimeout) => {\n  _s();\n  const dispatch = useDispatch();\n  const pollIntervalRef = useRef(null);\n  const pollCountRef = useRef(0);\n  const MAX_POLLING_RETRIES = 12; // 12 lần * 5s = 60s\n  const POLLING_INTERVAL = 5000; // 5 giây\n\n  const stopPolling = () => {\n    if (pollIntervalRef.current) {\n      clearInterval(pollIntervalRef.current);\n      pollIntervalRef.current = null;\n      console.log('Polling stopped.');\n      dispatch(cancelPaymentPolling());\n    }\n  };\n  const startPolling = () => {\n    // Ngăn chặn việc chạy nhiều polling cùng lúc\n    stopPolling();\n    pollCountRef.current = 0;\n    console.log('Starting payment status polling...');\n    const checkStatus = async () => {\n      // Dừng nếu quá số lần thử\n      if (pollCountRef.current >= MAX_POLLING_RETRIES) {\n        console.log('Max polling retries reached. Stopping.');\n        stopPolling();\n        onTimeout === null || onTimeout === void 0 ? void 0 : onTimeout(); // Gọi hàm khi timeout\n        return;\n      }\n      pollCountRef.current += 1;\n      console.log(`Checking payment status for order: ${orderId} (Attempt ${pollCountRef.current}/${MAX_POLLING_RETRIES})`);\n      try {\n        const resultAction = await dispatch(checkPaymentStatus(orderId));\n        if (checkPaymentStatus.fulfilled.match(resultAction)) {\n          var _resultAction$payload, _resultAction$payload2;\n          const paymentStatus = (_resultAction$payload = resultAction.payload) === null || _resultAction$payload === void 0 ? void 0 : (_resultAction$payload2 = _resultAction$payload.payment) === null || _resultAction$payload2 === void 0 ? void 0 : _resultAction$payload2.status;\n          console.log('Payment status check result:', paymentStatus);\n          if (paymentStatus === 'paid') {\n            stopPolling();\n            onPaymentSuccess(); // Gọi hàm khi thành công\n          } else if (paymentStatus === 'failed') {\n            stopPolling();\n            onPaymentFail(); // Gọi hàm khi thất bại\n          }\n        }\n      } catch (err) {\n        console.error(\"Error checking payment status:\", err);\n      }\n    };\n\n    // Kiểm tra ngay lần đầu tiên, sau đó lặp lại\n    checkStatus();\n    pollIntervalRef.current = setInterval(checkStatus, POLLING_INTERVAL);\n  };\n  useEffect(() => {\n    if (shouldPoll && orderId) {\n      startPolling();\n    } else {\n      stopPolling();\n    }\n\n    // Hàm dọn dẹp: tự động dừng polling khi component unmount\n    return () => stopPolling();\n  }, [shouldPoll, orderId]);\n  return {\n    stopPolling\n  };\n};\n_s(usePaymentPolling, \"JCHmsv/m47uYN7mf4FbhpNuS8Jc=\", false, function () {\n  return [useDispatch];\n});\nconst Payment = () => {\n  _s2();\n  const location = useLocation();\n  const navigate = useNavigate();\n  const dispatch = useDispatch();\n\n  // Lấy dữ liệu từ location.state một cách an toàn\n  const {\n    orderId,\n    totalPrice = 0,\n    preferredMethod = 'PayOS',\n    directPayment = false\n  } = location.state || {};\n  const [selectedPaymentMethod, setSelectedPaymentMethod] = useState(preferredMethod);\n  const [showPayosIframe, setShowPayosIframe] = useState(false);\n  const {\n    payment,\n    loading,\n    error,\n    success\n  } = useSelector(state => state.payment);\n\n  // 💡 SỬ DỤNG CUSTOM HOOK\n  // Logic polling giờ đây chỉ cần khai báo, không cần viết lại trong component\n  const handlePaymentSuccess = () => {\n    toast.success(\"Thanh toán thành công!\");\n    dispatch(resetPayment());\n    sessionStorage.setItem(`payment_${orderId}_completed`, 'true'); // Đánh dấu đã xong\n    navigate('/', {\n      replace: true\n    });\n  };\n  const handlePaymentFail = () => {\n    toast.error(\"Thanh toán thất bại!\");\n    dispatch(resetPayment());\n    navigate('/payment-result', {\n      state: {\n        status: 'failed',\n        orderId\n      },\n      replace: true\n    });\n  };\n  const handlePollingTimeout = () => {\n    toast.warn(\"Không nhận được phản hồi thanh toán. Vui lòng kiểm tra lịch sử đơn hàng.\");\n    navigate('/order-history', {\n      replace: true\n    });\n  };\n  const {\n    stopPolling\n  } = usePaymentPolling(orderId, showPayosIframe,\n  // Chỉ poll khi iframe được hiển thị\n  handlePaymentSuccess, handlePaymentFail, handlePollingTimeout);\n\n  // Tự động xử lý thanh toán nếu đến từ trang lịch sử đơn hàng\n  useEffect(() => {\n    if (orderId && directPayment && selectedPaymentMethod === 'PayOS') {\n      handlePayment();\n    }\n  }, [orderId, directPayment]);\n\n  // Xử lý khi API createPayment trả về kết quả\n  useEffect(() => {\n    if (error) {\n      toast.error(error);\n      dispatch(resetPayment());\n    }\n    if (success) {\n      if (selectedPaymentMethod === 'PayOS') {\n        if (payment !== null && payment !== void 0 && payment.paymentUrl) {\n          setShowPayosIframe(true);\n          toast.info(\"Cổng thanh toán PayOS đã sẵn sàng.\");\n        } else {\n          toast.error(\"Không thể tạo liên kết thanh toán PayOS.\");\n          dispatch(resetPayment());\n        }\n      } else if (selectedPaymentMethod === 'COD') {\n        toast.success(\"Đã tạo đơn hàng COD thành công.\");\n        setTimeout(() => {\n          navigate('/payment-result', {\n            state: {\n              status: 'paid',\n              orderId\n            },\n            replace: true\n          });\n        }, 1500);\n      }\n    }\n  }, [success, error, payment, dispatch, navigate]);\n  if (!orderId) {\n    toast.error(\"Không tìm thấy thông tin đơn hàng.\");\n    useEffect(() => navigate(\"/\", {\n      replace: true\n    }), []);\n    return null;\n  }\n  const handlePayment = () => {\n    dispatch(createPayment({\n      orderId: String(orderId),\n      method: selectedPaymentMethod,\n      replaceExisting: directPayment\n    }));\n  };\n  const handleBackToHome = () => {\n    setShowPayosIframe(false);\n    stopPolling(); // Dừng polling khi người dùng chủ động thoát\n    dispatch(resetPayment());\n    navigate(\"/\");\n  };\n\n  // Các hàm render và JSX không thay đổi nhiều\n  const renderPaymentMethods = () => {\n    // ... (Giữ nguyên code render của bạn)\n  };\n  return /*#__PURE__*/_jsxDEV(Container, {\n    maxWidth: \"lg\",\n    sx: {\n      py: 6\n    },\n    children: /*#__PURE__*/_jsxDEV(motion.div, {\n      initial: {\n        opacity: 0,\n        y: 20\n      },\n      animate: {\n        opacity: 1,\n        y: 0\n      },\n      transition: {\n        duration: 0.5\n      },\n      children: [/*#__PURE__*/_jsxDEV(Typography, {\n        variant: \"h4\",\n        component: \"h1\",\n        gutterBottom: true,\n        sx: {\n          fontWeight: 700,\n          color: '#0F52BA',\n          position: 'relative',\n          pb: 2,\n          mb: 4,\n          '&:after': {\n            content: '\"\"',\n            position: 'absolute',\n            bottom: 0,\n            left: 0,\n            width: '60px',\n            height: '4px',\n            backgroundColor: '#0F52BA',\n            borderRadius: '2px'\n          }\n        },\n        children: [/*#__PURE__*/_jsxDEV(PaymentIcon, {\n          sx: {\n            mr: 1,\n            verticalAlign: 'middle'\n          }\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 219,\n          columnNumber: 11\n        }, this), comingFromOrderPage ? 'Payment Method: PayOS' : 'Select Payment Method']\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 197,\n        columnNumber: 9\n      }, this), showPayosIframe && payment !== null && payment !== void 0 && payment.paymentUrl ? /*#__PURE__*/_jsxDEV(Paper, {\n        elevation: 3,\n        sx: {\n          p: 4,\n          borderRadius: 2,\n          maxWidth: 800,\n          mx: 'auto',\n          overflow: 'hidden',\n          boxShadow: '0 10px 30px rgba(0,0,0,0.1)'\n        },\n        children: [/*#__PURE__*/_jsxDEV(Typography, {\n          variant: \"h5\",\n          fontWeight: 600,\n          mb: 3,\n          children: \"PayOS Payment\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 235,\n          columnNumber: 13\n        }, this), /*#__PURE__*/_jsxDEV(Box, {\n          sx: {\n            height: \"600px\",\n            border: '1px solid #eaeaea',\n            borderRadius: 2,\n            overflow: 'hidden',\n            mb: 3\n          },\n          children: /*#__PURE__*/_jsxDEV(\"iframe\", {\n            ref: payosIframeRef,\n            src: payment.paymentUrl,\n            style: {\n              width: \"100%\",\n              height: \"100%\",\n              border: \"none\"\n            },\n            title: \"PayOS Payment\",\n            allow: \"payment\",\n            onError: handlePayOsIframeError\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 247,\n            columnNumber: 15\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 238,\n          columnNumber: 13\n        }, this), /*#__PURE__*/_jsxDEV(Grid, {\n          container: true,\n          spacing: 2,\n          justifyContent: \"space-between\",\n          children: [/*#__PURE__*/_jsxDEV(Grid, {\n            item: true,\n            children: /*#__PURE__*/_jsxDEV(Button, {\n              variant: \"contained\",\n              onClick: openPaymentPage,\n              startIcon: /*#__PURE__*/_jsxDEV(PaymentIcon, {}, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 265,\n                columnNumber: 30\n              }, this),\n              sx: {\n                backgroundColor: '#0F52BA',\n                '&:hover': {\n                  backgroundColor: '#0A3C8A'\n                },\n                px: 3,\n                py: 1\n              },\n              children: \"Open in new tab\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 262,\n              columnNumber: 17\n            }, this)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 261,\n            columnNumber: 15\n          }, this), /*#__PURE__*/_jsxDEV(Grid, {\n            item: true,\n            children: /*#__PURE__*/_jsxDEV(Button, {\n              variant: \"outlined\",\n              onClick: handleBackToHome,\n              startIcon: /*#__PURE__*/_jsxDEV(HomeIcon, {}, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 282,\n                columnNumber: 30\n              }, this),\n              sx: {\n                borderColor: '#0F52BA',\n                color: '#0F52BA',\n                '&:hover': {\n                  borderColor: '#0A3C8A',\n                  backgroundColor: 'rgba(15, 82, 186, 0.04)'\n                },\n                px: 3,\n                py: 1\n              },\n              children: \"Return to home\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 279,\n              columnNumber: 17\n            }, this)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 278,\n            columnNumber: 15\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 260,\n          columnNumber: 13\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 224,\n        columnNumber: 11\n      }, this) : /*#__PURE__*/_jsxDEV(Grid, {\n        container: true,\n        spacing: 4,\n        children: [/*#__PURE__*/_jsxDEV(Grid, {\n          item: true,\n          xs: 12,\n          md: 7,\n          children: /*#__PURE__*/_jsxDEV(Paper, {\n            elevation: 3,\n            sx: {\n              p: 4,\n              borderRadius: 2,\n              height: '100%',\n              boxShadow: '0 10px 30px rgba(0,0,0,0.1)'\n            },\n            children: [/*#__PURE__*/_jsxDEV(Typography, {\n              variant: \"h5\",\n              fontWeight: 600,\n              mb: 3,\n              children: comingFromOrderPage ? 'Payment Method' : 'Choose Payment Method'\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 311,\n              columnNumber: 17\n            }, this), /*#__PURE__*/_jsxDEV(FormControl, {\n              component: \"fieldset\",\n              sx: {\n                width: '100%'\n              },\n              children: renderPaymentMethods()\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 315,\n              columnNumber: 17\n            }, this), !success && /*#__PURE__*/_jsxDEV(Button, {\n              variant: \"contained\",\n              fullWidth: true,\n              size: \"large\",\n              onClick: handlePayment,\n              disabled: loading,\n              sx: {\n                mt: 3,\n                py: 1.5,\n                backgroundColor: '#0F52BA',\n                '&:hover': {\n                  backgroundColor: '#0A3C8A'\n                },\n                fontWeight: 600\n              },\n              children: loading ? /*#__PURE__*/_jsxDEV(_Fragment, {\n                children: [/*#__PURE__*/_jsxDEV(CircularProgress, {\n                  size: 24,\n                  sx: {\n                    color: 'white',\n                    mr: 1\n                  }\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 338,\n                  columnNumber: 25\n                }, this), \"Processing...\"]\n              }, void 0, true) : 'Proceed to Payment'\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 320,\n              columnNumber: 19\n            }, this), success && /*#__PURE__*/_jsxDEV(Button, {\n              variant: \"outlined\",\n              fullWidth: true,\n              size: \"large\",\n              onClick: handleBackToHome,\n              startIcon: /*#__PURE__*/_jsxDEV(HomeIcon, {}, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 353,\n                columnNumber: 32\n              }, this),\n              sx: {\n                mt: 3,\n                py: 1.5,\n                borderColor: '#0F52BA',\n                color: '#0F52BA',\n                '&:hover': {\n                  borderColor: '#0A3C8A',\n                  backgroundColor: 'rgba(15, 82, 186, 0.04)'\n                },\n                fontWeight: 600\n              },\n              children: \"Return to Home\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 348,\n              columnNumber: 19\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 302,\n            columnNumber: 15\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 301,\n          columnNumber: 13\n        }, this), /*#__PURE__*/_jsxDEV(Grid, {\n          item: true,\n          xs: 12,\n          md: 5,\n          children: [/*#__PURE__*/_jsxDEV(Paper, {\n            elevation: 3,\n            sx: {\n              p: 4,\n              borderRadius: 2,\n              boxShadow: '0 10px 30px rgba(0,0,0,0.1)'\n            },\n            children: [/*#__PURE__*/_jsxDEV(Typography, {\n              variant: \"h5\",\n              fontWeight: 600,\n              mb: 3,\n              children: \"Order Summary\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 381,\n              columnNumber: 17\n            }, this), /*#__PURE__*/_jsxDEV(Box, {\n              sx: {\n                mb: 3\n              },\n              children: [/*#__PURE__*/_jsxDEV(Box, {\n                sx: {\n                  display: 'flex',\n                  justifyContent: 'space-between',\n                  mb: 2\n                },\n                children: [/*#__PURE__*/_jsxDEV(Typography, {\n                  variant: \"body1\",\n                  color: \"text.secondary\",\n                  children: \"Order ID:\"\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 387,\n                  columnNumber: 21\n                }, this), /*#__PURE__*/_jsxDEV(Typography, {\n                  variant: \"body1\",\n                  fontWeight: 500,\n                  children: orderId\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 388,\n                  columnNumber: 21\n                }, this)]\n              }, void 0, true, {\n                fileName: _jsxFileName,\n                lineNumber: 386,\n                columnNumber: 19\n              }, this), /*#__PURE__*/_jsxDEV(Divider, {\n                sx: {\n                  my: 2\n                }\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 391,\n                columnNumber: 19\n              }, this), /*#__PURE__*/_jsxDEV(Box, {\n                sx: {\n                  display: 'flex',\n                  justifyContent: 'space-between',\n                  mb: 1\n                },\n                children: [/*#__PURE__*/_jsxDEV(Typography, {\n                  variant: \"h6\",\n                  children: \"Total:\"\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 394,\n                  columnNumber: 21\n                }, this), /*#__PURE__*/_jsxDEV(Typography, {\n                  variant: \"h6\",\n                  fontWeight: 700,\n                  color: \"#0F52BA\",\n                  children: [\"$\", formattedPrice]\n                }, void 0, true, {\n                  fileName: _jsxFileName,\n                  lineNumber: 395,\n                  columnNumber: 21\n                }, this)]\n              }, void 0, true, {\n                fileName: _jsxFileName,\n                lineNumber: 393,\n                columnNumber: 19\n              }, this)]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 385,\n              columnNumber: 17\n            }, this), /*#__PURE__*/_jsxDEV(Box, {\n              sx: {\n                p: 2,\n                backgroundColor: 'rgba(15, 82, 186, 0.04)',\n                borderRadius: 2,\n                border: '1px dashed #0F52BA'\n              },\n              children: /*#__PURE__*/_jsxDEV(Typography, {\n                variant: \"body2\",\n                color: \"text.secondary\",\n                children: [\"By proceeding with this payment, you agree to our terms and conditions.\", !comingFromOrderPage && ' For Cash on Delivery orders, please have the exact amount ready at the time of delivery.']\n              }, void 0, true, {\n                fileName: _jsxFileName,\n                lineNumber: 407,\n                columnNumber: 19\n              }, this)\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 401,\n              columnNumber: 17\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 373,\n            columnNumber: 15\n          }, this), /*#__PURE__*/_jsxDEV(Button, {\n            variant: \"text\",\n            startIcon: /*#__PURE__*/_jsxDEV(ArrowBackIcon, {}, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 416,\n              columnNumber: 28\n            }, this),\n            onClick: () => navigate(-1),\n            sx: {\n              mt: 2,\n              color: '#0F52BA',\n              '&:hover': {\n                backgroundColor: 'rgba(15, 82, 186, 0.04)'\n              }\n            },\n            children: \"Back to Checkout\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 414,\n            columnNumber: 15\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 372,\n          columnNumber: 13\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 300,\n        columnNumber: 11\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 192,\n      columnNumber: 7\n    }, this)\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 191,\n    columnNumber: 5\n  }, this);\n};\n_s2(Payment, \"8bJiBb7sKN0IMI3nujhZOpNWfu4=\", false, function () {\n  return [useLocation, useNavigate, useDispatch, useSelector, usePaymentPolling];\n});\n_c = Payment;\nexport default Payment;\nvar _c;\n$RefreshReg$(_c, \"Payment\");","map":{"version":3,"names":["React","useState","useEffect","useRef","useLocation","useNavigate","useDispatch","useSelector","toast","createPayment","resetPayment","checkPaymentStatus","cancelPaymentPolling","motion","Box","Container","Typography","Radio","RadioGroup","FormControlLabel","FormControl","Button","Paper","Divider","CircularProgress","Grid","PaymentIcon","LocalAtmIcon","HomeIcon","ArrowBackIcon","usePaymentPolling","orderId","shouldPoll","onPaymentSuccess","onPaymentFail","onTimeout","dispatch","pollIntervalRef","pollCountRef","MAX_POLLING_RETRIES","POLLING_INTERVAL","stopPolling","current","clearInterval","console","log","startPolling","checkStatus","resultAction","fulfilled","match","paymentStatus","payload","payment","status","err","error","setInterval","Payment","location","navigate","totalPrice","preferredMethod","directPayment","state","selectedPaymentMethod","setSelectedPaymentMethod","showPayosIframe","setShowPayosIframe","loading","success","handlePaymentSuccess","sessionStorage","setItem","replace","handlePaymentFail","handlePollingTimeout","warn","handlePayment","paymentUrl","info","setTimeout","String","method","replaceExisting","handleBackToHome","renderPaymentMethods","py","opacity","y","duration","fontWeight","color","position","pb","mb","content","bottom","left","width","height","backgroundColor","borderRadius","mr","verticalAlign","comingFromOrderPage","p","maxWidth","mx","overflow","boxShadow","border","payosIframeRef","handlePayOsIframeError","openPaymentPage","px","borderColor","mt","display","justifyContent","my","formattedPrice"],"sources":["D:/SU25/SDN302 - HOANNN/Shopii-Template/front-end/src/pages/Payment/Payment.jsx"],"sourcesContent":["import React, { useState, useEffect, useRef } from \"react\";\nimport { useLocation, useNavigate } from \"react-router-dom\";\nimport { useDispatch, useSelector } from \"react-redux\";\nimport { toast } from \"react-toastify\";\nimport { createPayment, resetPayment, checkPaymentStatus, cancelPaymentPolling } from \"../../features/payment/paymentSlice\";\nimport { motion } from \"framer-motion\";\nimport {\n  Box, Container, Typography, Radio, RadioGroup, FormControlLabel,\n  FormControl, Button, Paper, Divider, CircularProgress, Grid\n} from \"@mui/material\";\nimport PaymentIcon from \"@mui/icons-material/Payment\";\nimport LocalAtmIcon from \"@mui/icons-material/LocalAtm\";\nimport HomeIcon from \"@mui/icons-material/Home\";\nimport ArrowBackIcon from \"@mui/icons-material/ArrowBack\";\n\n// ✨ CUSTOM HOOK: Tách logic polling ra khỏi component để tái sử dụng và quản lý dễ dàng hơn\nconst usePaymentPolling = (orderId, shouldPoll, onPaymentSuccess, onPaymentFail, onTimeout) => {\n  const dispatch = useDispatch();\n  const pollIntervalRef = useRef(null);\n  const pollCountRef = useRef(0);\n\n  const MAX_POLLING_RETRIES = 12; // 12 lần * 5s = 60s\n  const POLLING_INTERVAL = 5000; // 5 giây\n\n  const stopPolling = () => {\n    if (pollIntervalRef.current) {\n      clearInterval(pollIntervalRef.current);\n      pollIntervalRef.current = null;\n      console.log('Polling stopped.');\n      dispatch(cancelPaymentPolling());\n    }\n  };\n\n  const startPolling = () => {\n    // Ngăn chặn việc chạy nhiều polling cùng lúc\n    stopPolling();\n    pollCountRef.current = 0;\n    console.log('Starting payment status polling...');\n\n    const checkStatus = async () => {\n      // Dừng nếu quá số lần thử\n      if (pollCountRef.current >= MAX_POLLING_RETRIES) {\n        console.log('Max polling retries reached. Stopping.');\n        stopPolling();\n        onTimeout?.(); // Gọi hàm khi timeout\n        return;\n      }\n      \n      pollCountRef.current += 1;\n      console.log(`Checking payment status for order: ${orderId} (Attempt ${pollCountRef.current}/${MAX_POLLING_RETRIES})`);\n\n      try {\n        const resultAction = await dispatch(checkPaymentStatus(orderId));\n        if (checkPaymentStatus.fulfilled.match(resultAction)) {\n          const paymentStatus = resultAction.payload?.payment?.status;\n          console.log('Payment status check result:', paymentStatus);\n\n          if (paymentStatus === 'paid') {\n            stopPolling();\n            onPaymentSuccess(); // Gọi hàm khi thành công\n          } else if (paymentStatus === 'failed') {\n            stopPolling();\n            onPaymentFail(); // Gọi hàm khi thất bại\n          }\n        }\n      } catch (err) {\n        console.error(\"Error checking payment status:\", err);\n      }\n    };\n\n    // Kiểm tra ngay lần đầu tiên, sau đó lặp lại\n    checkStatus();\n    pollIntervalRef.current = setInterval(checkStatus, POLLING_INTERVAL);\n  };\n\n  useEffect(() => {\n    if (shouldPoll && orderId) {\n      startPolling();\n    } else {\n      stopPolling();\n    }\n\n    // Hàm dọn dẹp: tự động dừng polling khi component unmount\n    return () => stopPolling();\n  }, [shouldPoll, orderId]);\n\n  return { stopPolling };\n};\n\n\nconst Payment = () => {\n  const location = useLocation();\n  const navigate = useNavigate();\n  const dispatch = useDispatch();\n\n  // Lấy dữ liệu từ location.state một cách an toàn\n  const { orderId, totalPrice = 0, preferredMethod = 'PayOS', directPayment = false } = location.state || {};\n\n  const [selectedPaymentMethod, setSelectedPaymentMethod] = useState(preferredMethod);\n  const [showPayosIframe, setShowPayosIframe] = useState(false);\n\n  const { payment, loading, error, success } = useSelector((state) => state.payment);\n  \n  // 💡 SỬ DỤNG CUSTOM HOOK\n  // Logic polling giờ đây chỉ cần khai báo, không cần viết lại trong component\n  const handlePaymentSuccess = () => {\n    toast.success(\"Thanh toán thành công!\");\n    dispatch(resetPayment());\n    sessionStorage.setItem(`payment_${orderId}_completed`, 'true'); // Đánh dấu đã xong\n    navigate('/', { replace: true });\n  };\n\n  const handlePaymentFail = () => {\n    toast.error(\"Thanh toán thất bại!\");\n    dispatch(resetPayment());\n    navigate('/payment-result', { state: { status: 'failed', orderId }, replace: true });\n  };\n  \n  const handlePollingTimeout = () => {\n      toast.warn(\"Không nhận được phản hồi thanh toán. Vui lòng kiểm tra lịch sử đơn hàng.\");\n      navigate('/order-history', { replace: true });\n  };\n\n  const { stopPolling } = usePaymentPolling(\n    orderId,\n    showPayosIframe, // Chỉ poll khi iframe được hiển thị\n    handlePaymentSuccess,\n    handlePaymentFail,\n    handlePollingTimeout\n  );\n\n  // Tự động xử lý thanh toán nếu đến từ trang lịch sử đơn hàng\n  useEffect(() => {\n    if (orderId && directPayment && selectedPaymentMethod === 'PayOS') {\n      handlePayment();\n    }\n  }, [orderId, directPayment]);\n\n  // Xử lý khi API createPayment trả về kết quả\n  useEffect(() => {\n    if (error) {\n      toast.error(error);\n      dispatch(resetPayment());\n    }\n\n    if (success) {\n      if (selectedPaymentMethod === 'PayOS') {\n        if (payment?.paymentUrl) {\n          setShowPayosIframe(true);\n          toast.info(\"Cổng thanh toán PayOS đã sẵn sàng.\");\n        } else {\n          toast.error(\"Không thể tạo liên kết thanh toán PayOS.\");\n          dispatch(resetPayment());\n        }\n      } else if (selectedPaymentMethod === 'COD') {\n        toast.success(\"Đã tạo đơn hàng COD thành công.\");\n        setTimeout(() => {\n          navigate('/payment-result', { state: { status: 'paid', orderId }, replace: true });\n        }, 1500);\n      }\n    }\n  }, [success, error, payment, dispatch, navigate]);\n\n  if (!orderId) {\n    toast.error(\"Không tìm thấy thông tin đơn hàng.\");\n    useEffect(() => navigate(\"/\", { replace: true }), []);\n    return null;\n  }\n  \n  const handlePayment = () => {\n    dispatch(createPayment({\n      orderId: String(orderId),\n      method: selectedPaymentMethod,\n      replaceExisting: directPayment\n    }));\n  };\n\n  const handleBackToHome = () => {\n    setShowPayosIframe(false);\n    stopPolling(); // Dừng polling khi người dùng chủ động thoát\n    dispatch(resetPayment());\n    navigate(\"/\");\n  };\n  \n  // Các hàm render và JSX không thay đổi nhiều\n  const renderPaymentMethods = () => {\n      // ... (Giữ nguyên code render của bạn)\n  };\n\n  return (\n    <Container maxWidth=\"lg\" sx={{ py: 6 }}>\n      <motion.div\n        initial={{ opacity: 0, y: 20 }}\n        animate={{ opacity: 1, y: 0 }}\n        transition={{ duration: 0.5 }}\n      >\n        <Typography \n          variant=\"h4\" \n          component=\"h1\" \n          gutterBottom \n          sx={{ \n            fontWeight: 700,\n            color: '#0F52BA',\n            position: 'relative',\n            pb: 2,\n            mb: 4,\n            '&:after': {\n              content: '\"\"',\n              position: 'absolute',\n              bottom: 0,\n              left: 0,\n              width: '60px',\n              height: '4px',\n              backgroundColor: '#0F52BA',\n              borderRadius: '2px'\n            }\n          }}\n        >\n          <PaymentIcon sx={{ mr: 1, verticalAlign: 'middle' }} />\n          {comingFromOrderPage ? 'Payment Method: PayOS' : 'Select Payment Method'}\n        </Typography>\n        \n        {showPayosIframe && payment?.paymentUrl ? (\n          <Paper \n            elevation={3} \n            sx={{ \n              p: 4, \n              borderRadius: 2,\n              maxWidth: 800,\n              mx: 'auto',\n              overflow: 'hidden',\n              boxShadow: '0 10px 30px rgba(0,0,0,0.1)'\n            }}\n          >\n            <Typography variant=\"h5\" fontWeight={600} mb={3}>\n              PayOS Payment\n            </Typography>\n            <Box \n              sx={{ \n                height: \"600px\", \n                border: '1px solid #eaeaea',\n                borderRadius: 2,\n                overflow: 'hidden',\n                mb: 3\n              }}\n            >\n              <iframe \n                ref={payosIframeRef}\n                src={payment.paymentUrl}\n                style={{\n                  width: \"100%\",\n                  height: \"100%\",\n                  border: \"none\"\n                }}\n                title=\"PayOS Payment\"\n                allow=\"payment\"\n                onError={handlePayOsIframeError}\n              />\n            </Box>\n            <Grid container spacing={2} justifyContent=\"space-between\">\n              <Grid item>\n                <Button\n                  variant=\"contained\"\n                  onClick={openPaymentPage}\n                  startIcon={<PaymentIcon />}\n                  sx={{ \n                    backgroundColor: '#0F52BA',\n                    '&:hover': {\n                      backgroundColor: '#0A3C8A',\n                    },\n                    px: 3,\n                    py: 1\n                  }}\n                >\n                  Open in new tab\n                </Button>\n              </Grid>\n              <Grid item>\n                <Button\n                  variant=\"outlined\"\n                  onClick={handleBackToHome}\n                  startIcon={<HomeIcon />}\n                  sx={{ \n                    borderColor: '#0F52BA',\n                    color: '#0F52BA',\n                    '&:hover': {\n                      borderColor: '#0A3C8A',\n                      backgroundColor: 'rgba(15, 82, 186, 0.04)',\n                    },\n                    px: 3,\n                    py: 1\n                  }}\n                >\n                  Return to home\n                </Button>\n              </Grid>\n            </Grid>\n          </Paper>\n        ) : (\n          <Grid container spacing={4}>\n            <Grid item xs={12} md={7}>\n              <Paper \n                elevation={3} \n                sx={{ \n                  p: 4, \n                  borderRadius: 2,\n                  height: '100%',\n                  boxShadow: '0 10px 30px rgba(0,0,0,0.1)'\n                }}\n              >\n                <Typography variant=\"h5\" fontWeight={600} mb={3}>\n                  {comingFromOrderPage ? 'Payment Method' : 'Choose Payment Method'}\n                </Typography>\n                \n                <FormControl component=\"fieldset\" sx={{ width: '100%' }}>\n                  {renderPaymentMethods()}\n                </FormControl>\n                \n                {!success && (\n                  <Button\n                    variant=\"contained\"\n                    fullWidth\n                    size=\"large\"\n                    onClick={handlePayment}\n                    disabled={loading}\n                    sx={{ \n                      mt: 3, \n                      py: 1.5,\n                      backgroundColor: '#0F52BA',\n                      '&:hover': {\n                        backgroundColor: '#0A3C8A',\n                      },\n                      fontWeight: 600\n                    }}\n                  >\n                    {loading ? (\n                      <>\n                        <CircularProgress size={24} sx={{ color: 'white', mr: 1 }} />\n                        Processing...\n                      </>\n                    ) : (\n                      'Proceed to Payment'\n                    )}\n                  </Button>\n                )}\n                \n                {success && (\n                  <Button\n                    variant=\"outlined\"\n                    fullWidth\n                    size=\"large\"\n                    onClick={handleBackToHome}\n                    startIcon={<HomeIcon />}\n                    sx={{ \n                      mt: 3,\n                      py: 1.5,\n                      borderColor: '#0F52BA',\n                      color: '#0F52BA',\n                      '&:hover': {\n                        borderColor: '#0A3C8A',\n                        backgroundColor: 'rgba(15, 82, 186, 0.04)',\n                      },\n                      fontWeight: 600\n                    }}\n                  >\n                    Return to Home\n                  </Button>\n                )}\n              </Paper>\n            </Grid>\n            \n            <Grid item xs={12} md={5}>\n              <Paper \n                elevation={3} \n                sx={{ \n                  p: 4, \n                  borderRadius: 2,\n                  boxShadow: '0 10px 30px rgba(0,0,0,0.1)'\n                }}\n              >\n                <Typography variant=\"h5\" fontWeight={600} mb={3}>\n                  Order Summary\n                </Typography>\n                \n                <Box sx={{ mb: 3 }}>\n                  <Box sx={{ display: 'flex', justifyContent: 'space-between', mb: 2 }}>\n                    <Typography variant=\"body1\" color=\"text.secondary\">Order ID:</Typography>\n                    <Typography variant=\"body1\" fontWeight={500}>{orderId}</Typography>\n                  </Box>\n                  \n                  <Divider sx={{ my: 2 }} />\n                  \n                  <Box sx={{ display: 'flex', justifyContent: 'space-between', mb: 1 }}>\n                    <Typography variant=\"h6\">Total:</Typography>\n                    <Typography variant=\"h6\" fontWeight={700} color=\"#0F52BA\">\n                      ${formattedPrice}\n                    </Typography>\n                  </Box>\n                </Box>\n                \n                <Box sx={{ \n                  p: 2, \n                  backgroundColor: 'rgba(15, 82, 186, 0.04)', \n                  borderRadius: 2,\n                  border: '1px dashed #0F52BA'\n                }}>\n                  <Typography variant=\"body2\" color=\"text.secondary\">\n                    By proceeding with this payment, you agree to our terms and conditions. \n                    {!comingFromOrderPage && ' For Cash on Delivery orders, please have the exact amount ready at the time of delivery.'}\n                  </Typography>\n                </Box>\n              </Paper>\n              \n              <Button\n                variant=\"text\"\n                startIcon={<ArrowBackIcon />}\n                onClick={() => navigate(-1)}\n                sx={{ \n                  mt: 2,\n                  color: '#0F52BA',\n                  '&:hover': {\n                    backgroundColor: 'rgba(15, 82, 186, 0.04)',\n                  }\n                }}\n              >\n                Back to Checkout\n              </Button>\n            </Grid>\n          </Grid>\n        )}\n      </motion.div>\n    </Container>\n  );\n};\n\nexport default Payment;"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}